<div class="relative overflow-x-auto">
  <app-title titulo="REPORTE HISTÓRICO DE CALIBRACIÓN"></app-title>
  
  <!-- Filtros -->
  <div class="max-w-[22rem] mx-auto p-4 bg-white rounded-lg shadow-md border border-gray-300 mb-6">
    <div class="flex items-center justify-center">
      <!-- Validación del período -->
      <div *ngIf="!calendarData" style="height: 53px; margin-right: 0.5rem">
        <mat-form-field>
          <mat-select placeholder="Periodo"></mat-select>
        </mat-form-field>
      </div>
      
      <div *ngIf="calendarData" style="height: 53px; margin-right: 0.5rem">
        <mat-form-field>
          <mat-select placeholder="Periodo" [(ngModel)]="Periodo">
            <mat-option *ngFor="let item of calendarData.registros" [value]="item">
              {{ item.vNombre }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      
      <!-- Botón de búsqueda -->
      <button 
        style="width: 107.42px;" 
        (click)="FilterData()"  
        class="items-center justify-center py-2 bg-blue-600 text-white rounded-md flex items-center hover:bg-blue-700 ">
        <svg class="w-5 h-5 text-white" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="m21 21-3.5-3.5M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"/>
        </svg>
        Buscar
      </button>
    </div>
  </div>
  
  <!-- Tabla -->
  <table *ngIf="Activatetable" border="1" style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr>
        <th class="px-6 py-3 border" style="width: 8rem;">FOTO</th>
        <th class="px-6 py-3 border" style="width: 5.9rem;">COD. FICHA DEL EVALUADO</th>
        <th class="px-6 py-3 border" style="width: 35rem;">APELLIDOS Y NOMBRES DEL EVALUADO</th>
        <th class="px-6 py-3 border" style="width: 5.9rem;">COD. FICHA DEL EVALUADOR</th>
        <th class="px-6 py-3 border" style="width: 35rem;">APELLIDOS Y NOMBRES DEL EVALUADOR</th>
        <th class="px-6 py-3 border" style="width: 2rem;">FECHA CALIBRACIÓN</th>
        <th class="px-6 py-3 border">ACCIONES</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let item of data.registros">
        <!-- Primera fila del evaluado -->
        <tr class="border">
          <td  class="px-6">
            <img 
              class="w-20 h-20" 
              [src]="item?.evaluado?.foto" 
              crossorigin="anonymous" (error)="onImgError($event)" 
              alt="Foto"
            >
          </td>
          <td class="px-6" >{{ item?.evaluado?.codigoFicha }}</td>
          <td class="px-6" >{{ item?.evaluado?.apellidosNombres }}</td>
          <td class="px-6" >{{ item?.evaluador?.codigoFicha }}</td>
          <td class="px-6" >{{ item?.evaluador?.apellidosNombres }}</td>
          <td class="px-6">{{ item.fechaRegistro | date: 'dd/MM/yyyy' }}</td>
          <td class="px-6" >
            <button 
              type="button" 
              (click)="ShowModal(item)" 
              *ngIf="item?.estadoCalibracion"
              class="text-white bg-green-500 hover:bg-green-600 font-medium rounded-lg text-sm px-2.5 py-2.5 w-full">
              Ver resultados
            </button>
            <button 
              type="button"
              *ngIf="!item?.estadoCalibracion"
              style="cursor: not-allowed;" 
              class="text-white bg-gray-500 font-medium rounded-lg text-sm px-2.5 py-2.5 w-full cursor-not-allowed">
              Ver resultados
            </button>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>
</div>

<!-- Modal -->
<app-comparativecalibrationsmodal 
  *ngIf="showComparativeModal" 
  [CalibrationData]="CalibrationData" 
  [CalendarData]="Periodo"
  [CalibrationID]="CalibrationID"
  (close)="closeModal()">
</app-comparativecalibrationsmodal>
