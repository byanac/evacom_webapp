

<div class="relative overflow-x-auto">
    <app-title titulo="Reporte del personal a cargo de {{EvaluatorName}} - {{PeriodName}}"></app-title>
  <div class="max-w-[22rem] mx-auto p-4 bg-white rounded-lg shadow-md border border-gray-300 rounded-md mb-6">
  <div class="flex items-center justify-center">
        <div *ngIf="Tipo != undefined" style="height: 53px; margin-right: 0.5rem;">
          <mat-form-field style="width: 195px;">
            <mat-select placeholder="Tipo" [(ngModel)]="Tipo">
              <mat-option value="PID">PID</mat-option>
              <mat-option value="CUMPLIMIENTO">CUMPLIMIENTO DE PID</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <button style="width: 107.42px;" (click)="FilterData()"  class="items-center justify-center py-2 bg-blue-600 text-white rounded-md flex items-center hover:bg-blue-700 ">
          <svg class="w-5 h-5 text-white"  xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
            <path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="m21 21-3.5-3.5M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"/>
          </svg>  
          Buscar              
        </button>
  </div>  
</div>

<app-targetscounters
  *ngIf="Activatetable"
  [DataToCount]="DataList.registros"
  [ConfirmedEntryName]="Tipo === 'PID' ? 'veredictoRegistro' : 'veredictoCumplimiento'"
  [ConfirmText]="Tipo === 'PID' ? 'PID aprobados' : 'Cumplimiento de PID aprobados'"
  [NotConfirmedText]="Tipo === 'PID' ? 'PID no aprobados' : 'Cumplimiento de PID no aprobados'">
</app-targetscounters>

<div *ngIf="Activatetable && (Tipo === 'PID' || Tipo === 'CUMPLIMIENTO')" class="relative overflow-x-auto">
  <table class="w-full text-sm text-left rtl:text-right text-gray-500 border solid">
      <thead class="text-xs text-gray-700 uppercase bg-gray-5">
          <tr>
              <th scope="col" class="px-6 py-3 border" style="width: 8rem;">Foto</th>
              <th scope="col" class="px-6 py-3 border" style="width: 5.9rem;">COD. FICHA</th>
              <th scope="col" class="px-6 py-3 border" style="width: 35rem;">APELLIDOS Y NOMBRES</th>
              <th scope="col" class="px-6 py-3 border" style="width: 8.5rem;">UNIDAD ORG√ÅNICA</th>
              <th scope="col" class="px-6 py-3 border" style="width: 6.8rem;">COD. PUESTO</th>
              <th scope="col" class="px-6 py-3 border text-wrap" style="width: 35rem;">PUESTO</th>
              <th scope="col" class="px-6 py-3 border" style="width: 10rem;">
                  {{ Tipo === 'PID' ? 'ESTADO DE PID' : 'ESTADO DE CUMPLIMIENTO DE PID' }}
              </th>
              <th scope="col" class="px-6 py-3 border" style="width: 15rem;">Acciones</th>
          </tr>
      </thead>
      <tbody>
          <tr *ngFor="let item of DataList.registros" class="border hover:bg-gray-100">
              <th class="px-6 py-4 text-black border">
                  <img class="w-20 h-20" [src]="item.foto" loading="lazy" 
 crossorigin="anonymous" (error)="onImgError($event)" alt="Foto">
              </th>
              <th class="px-6 py-4 text-gray-900 whitespace-nowrap">
                  <div class="text-base font-semibold">{{removeLeadingZeros(item.codigoFicha)}}</div>
              </th>
              <td class="px-6 py-4 text-black border">{{item.apellidosNombres}}</td>
              <td class="px-6 py-4 text-black border">{{item.unidadOrganica}}</td>
              <td class="px-6 py-4 text-black border">{{item.codigoPuesto}}</td>
              <td class="px-6 py-4 text-black border">{{item.nombrePuesto}}</td>
              <td class="px-6 py-4 text-black border">
                  <div *ngIf="Tipo === 'PID'">
                      <div *ngIf="item.estadoEvaluadoRegistro && item.estadoEvaluadorRegistro && item.veredictoRegistro" class="flex items-center">
                          <span class="badgegreen bg-green-500 w-full">APROBADO</span>
                      </div>
                      <div *ngIf="item.estadoEvaluadoRegistro && item.estadoEvaluadorRegistro && !item.veredictoRegistro" class="flex items-center">
                          <span class="badgered bg-red-500 w-full">RECHAZADO</span>
                      </div>
                      <div *ngIf="item.estadoEvaluadoRegistro && !item.estadoEvaluadorRegistro && !item.veredictoRegistro" class="flex items-center">
                          <span class="badgered bg-blue-500 w-full">REGISTRADO</span>
                      </div>
                      <div *ngIf="!item.estadoEvaluadoRegistro && !item.estadoEvaluadorRegistro && !item.veredictoRegistro" class="flex items-center">
                          <span class="badgered bg-orange-500 w-full">NO REGISTRADO</span>
                      </div>
                  </div>
                  <div *ngIf="Tipo === 'CUMPLIMIENTO'">
                      <div *ngIf="item.estadoEvaluadoCumplimiento && item.estadoEvaluadorCumplimiento && item.veredictoCumplimiento" class="flex items-center">
                          <span class="badgegreen bg-green-500">CUMPLIMIENTO DE PID APROBADO</span>
                      </div>
                      <div *ngIf="item.estadoEvaluadoCumplimiento && item.estadoEvaluadorCumplimiento && !item.veredictoCumplimiento" class="flex items-center">
                          <span class="badgered bg-red-500">CUMPLIMIENTO DE PID RECHAZADO</span>
                      </div>
                      <div *ngIf="item.estadoEvaluadoCumplimiento && !item.estadoEvaluadorCumplimiento && !item.veredictoCumplimiento" class="flex items-center">
                          <span class="badgered bg-blue-500">CUMPLIMIENTO DE PID REGISTRADO</span>
                      </div>
                      <div *ngIf="!item.estadoEvaluadoCumplimiento && !item.estadoEvaluadorCumplimiento && !item.veredictoCumplimiento" class="flex items-center">
                          <span class="badgered bg-orange-500">CUMPLIMIENTO DE PID NO REGISTRADO</span>
                      </div>
                  </div>
              </td>
              <td class="px-6 py-4 text-black border">
                  <div class="flex space-x-2">
                      <button *ngIf="Tipo === 'PID' && item.estadoEvaluadoRegistro && item.estadoEvaluadorRegistro"
                              [routerLink]="['/home/ver-pid-evaluado-reporteavance','EVALUATED',item.codigoPuesto,this.CalendarCode,item.codigoFicha]"
                              class="text-white bg-green-500 hover:bg-green-600 font-medium rounded-lg text-sm px-2.5 py-2.5 w-full">Ver PID</button>
                      
                      <button *ngIf="Tipo === 'PID' && item.estadoEvaluadoRegistro && !item.estadoEvaluadorRegistro"
                              [routerLink]="['/home/ver-pid-evaluado-reporteavance','EVALUATED',item.codigoPuesto,this.CalendarCode,item.codigoFicha]"
                              class="text-white bg-green-500 hover:bg-green-600 font-medium rounded-lg text-sm px-2.5 py-2.5 w-full">Ver PID</button>

                      <button (click)="NotifyEvaluated(item.apellidosNombres,item.codigoFicha)" *ngIf="Tipo === 'PID' && item.estadoEvaluadoRegistro && item.estadoEvaluadorRegistro && !item.veredictoRegistro"
                              class="text-white bg-blue-500 hover:bg-blue-600 font-medium rounded-lg text-sm px-2.5 py-2.5 w-full">Notificar evaluado</button>
                      
                      <button (click)="NotifyEvaluator(item.apellidosNombres,item.codigoFicha)" *ngIf="Tipo === 'PID' && item.estadoEvaluadoRegistro && !item.estadoEvaluadorRegistro"
                              class="text-white bg-blue-500 hover:bg-blue-600 font-medium rounded-lg text-sm px-2.5 py-2.5 w-full">Notificar evaluador</button>

                      <button (click)="NotifyEvaluated(item.apellidosNombres,item.codigoFicha)" *ngIf="Tipo === 'PID' && !item.estadoEvaluadoRegistro && !item.estadoEvaluadorRegistro"
                              class="text-white bg-blue-500 hover:bg-blue-600 font-medium rounded-lg text-sm px-2.5 py-2.5 w-full">Notificar evaluado</button>
                      
                      <button *ngIf="Tipo === 'CUMPLIMIENTO' && item.estadoEvaluadoCumplimiento && item.estadoEvaluadorCumplimiento"
                              [routerLink]="['/home/ver-cumplimiento-pid-evaluado-reporteavance','EVALUATED',item.codigoPuesto,this.CalendarCode,item.codigoFicha]"
                              class="text-white bg-green-500 hover:bg-green-600 font-medium rounded-lg text-sm px-2.5 py-2.5 w-full">Ver cumplimiento</button>

                      <button (click)="NotifyEvaluated(item.apellidosNombres,item.codigoFicha)" *ngIf="Tipo === 'CUMPLIMIENTO' && item.estadoEvaluadoCumplimiento && item.estadoEvaluadorCumplimiento && !item.veredictoCumplimiento"
                              class="text-white bg-blue-500 hover:bg-blue-600 font-medium rounded-lg text-sm px-2.5 py-2.5 w-full">Notificar evaluado</button>

                      <button *ngIf="Tipo === 'CUMPLIMIENTO' && item.estadoEvaluadoCumplimiento && !item.estadoEvaluadorCumplimiento"
                              [routerLink]="['/home/ver-cumplimiento-pid-evaluado-reporteavance','EVALUATED',item.codigoPuesto,this.CalendarCode,item.codigoFicha]"
                              class="text-white bg-green-500 hover:bg-green-600 font-medium rounded-lg text-sm px-2.5 py-2.5 w-full">Ver cumplimiento</button>

                      <button (click)="NotifyEvaluator(item.apellidosNombres,item.codigoFicha)" *ngIf="Tipo === 'CUMPLIMIENTO' && item.estadoEvaluadoCumplimiento && !item.estadoEvaluadorCumplimiento"
                              class="text-white bg-blue-500 hover:bg-blue-600 font-medium rounded-lg text-sm px-2.5 py-2.5 w-full">Notificar evaluador</button>
                      
                      <button (click)="NotifyEvaluated(item.apellidosNombres,item.codigoFicha)" *ngIf="Tipo === 'CUMPLIMIENTO' && !item.estadoEvaluadoCumplimiento && !item.estadoEvaluadorCumplimiento"
                              class="text-white bg-blue-500 hover:bg-blue-600 font-medium rounded-lg text-sm px-2.5 py-2.5 w-full">Notificar evaluado</button>
                  </div>
              </td>
          </tr>
      </tbody>
  </table>
</div>


</div> 