<div class="min-h-screen bg-gray-100">
  <header class="text-white py-4 px-6" style="background-color: #3776ff;">
    <h1 class="text-2xl font-bold mb-0">Registrar Calendario de Evaluación</h1>
  </header>
  <main class="container mx-auto px-4 py-8">
    <form [formGroup]="calendarioForm" (ngSubmit)="onSubmit()" class="space-y-8">
      <div class="grid gap-6">
        <div class="space-y-6">
          <!-- Tipo de Calendario -->
          <div class="space-y-2">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Tipo de Calendario</mat-label>
              <mat-select formControlName="tipo" required readonly>
                <mat-option value="">Seleccione el tipo</mat-option>
                <mat-option value="90">90°</mat-option>
                <mat-option value="180">180°</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="space-y-2">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Periodicidad</mat-label>
              <mat-select formControlName="periodicidad" required readonly>
                <mat-option value="">Seleccione periodicidad</mat-option>
                <mat-option *ngFor="let item of CalendarPeriodicites" [value]="item.codigo">{{item.valor}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <!-- Nombre del Calendario -->
          <div class="space-y-2">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Nombre del Calendario</mat-label>
              <input matInput formControlName="calnombre" required>
            </mat-form-field>
          </div>

          <!-- Inicio del Periodo -->
          <div class="space-y-2">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Inicio del Periodo</mat-label>
              <input matInput [matDatepicker]="fechaInicioPicker" formControlName="fechaInicio" required readonly>
              <mat-datepicker-toggle matSuffix [for]="fechaInicioPicker" class="mat-datepicker-toggle-centered"></mat-datepicker-toggle>
              <mat-datepicker #fechaInicioPicker></mat-datepicker>
            </mat-form-field>
          </div>
      
          <!-- Fin del Periodo -->
          <div class="space-y-2">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Fin del Periodo</mat-label>
              <input matInput [matDatepicker]="fechaFinPicker" formControlName="fechaFin" required readonly>
              <mat-datepicker-toggle matSuffix [for]="fechaFinPicker" class="mat-datepicker-toggle-centered"></mat-datepicker-toggle>
              <mat-datepicker #fechaFinPicker></mat-datepicker>
            </mat-form-field>
          </div>
        </div>
      </div>
      

      <div class="space-y-4">
        <h2 class="text-xl font-semibold">Fases del Proceso</h2>
        <div formGroupName="fases">
          <div *ngFor="let fase of fases" class="mb-4">
            <details class="bg-white shadow rounded-lg">
              <summary class="text-left px-4 py-2 cursor-pointer focus:outline-none flex">
                <span class="flex items-center justify-between w-full">
                  <span class="flex items-center">
                    <svg class="mr-2 h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                    </svg>
                    <span *ngIf="fase !== 'planDesarrollo'" class="capitalize">{{ endsWithOn(formatFaseName(fase))  }}</span>
                    <span *ngIf="fase === 'planDesarrollo'" class="">Plan individual de desarrollo (PID)</span>
                  </span>
                  <span>
                    <svg class="ml-2 h-4 w-4 transform rotate-90" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M5.5 7.5a1 1 0 011.5-1.3l3 3a1 1 0 010 1.4l-3 3a1 1 0 01-1.5-1.3L6.7 10 5.5 7.5z" clip-rule="evenodd" />
                    </svg>
                  </span>
                </span>
              </summary>
      
              <div class="px-4 py-2">
                <ng-container *ngIf="fase !== 'planDesarrollo'; else planDesarrollo">
                  <div [formGroupName]="fase" class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                      <mat-form-field appearance="outline" class="w-full">
                        <mat-label>Inicio del Periodo</mat-label>
                        <input matInput [matDatepicker]="fechaInicioPicker" formControlName="inicio" required readonly>
                        <mat-datepicker-toggle matSuffix [for]="fechaInicioPicker"></mat-datepicker-toggle>
                        <mat-datepicker #fechaInicioPicker></mat-datepicker>
                      </mat-form-field>
                    </div>
                    <div class="space-y-2">
                      <mat-form-field appearance="outline" class="w-full">
                        <mat-label>Fin del Periodo</mat-label>
                        <input matInput [matDatepicker]="fechaFinPicker" formControlName="fin" required readonly>
                        <mat-datepicker-toggle matSuffix [for]="fechaFinPicker" class="mat-datepicker-toggle-centered"></mat-datepicker-toggle>
                        <mat-datepicker #fechaFinPicker></mat-datepicker>
                      </mat-form-field>
                    </div>
                  </div>
                </ng-container>
                <ng-template #planDesarrollo>
                  <div formGroupName="planDesarrollo" class="space-y-4">
                    <div *ngFor="let item of PIDFases">
                      <h4 class="font-semibold mb-2">{{ item.label }}</h4>
                      <div [formGroupName]="item.formcontrolname" class="grid grid-cols-2 gap-4">
                        <div class="space-y-2">
                          <mat-form-field appearance="outline" class="w-full">
                            <mat-label>Inicio del Periodo</mat-label>
                            <input matInput [matDatepicker]="subfaseInicioPicker" formControlName="inicio" required readonly>
                            <mat-datepicker-toggle matSuffix [for]="subfaseInicioPicker"></mat-datepicker-toggle>
                            <mat-datepicker #subfaseInicioPicker></mat-datepicker>
                          </mat-form-field>
                        </div>
                        <div class="space-y-2">
                          <mat-form-field appearance="outline" class="w-full">
                            <mat-label>Fin del Periodo</mat-label>
                            <input matInput [matDatepicker]="subfaseFinPicker" formControlName="fin" required readonly>
                            <mat-datepicker-toggle matSuffix [for]="subfaseFinPicker" class="mat-datepicker-toggle-centered"></mat-datepicker-toggle>
                            <mat-datepicker #subfaseFinPicker></mat-datepicker>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-template>
              </div>
            </details>
          </div>
        </div>
      </div>
      
    </form>
  </main>

  <div class="bg-white p-6 rounded-lg shadow ">
    <h2 class="text-lg font-semibold mb-4">Resumen del Calendario<br>
    {{ calendarioForm.get('calnombre')?.value }}</h2>
    <ul class="space-y-2">
      <li *ngFor="let fase of fases" class="flex items-center text-sm" (click)="fase === 'planDesarrollo' ? changeViewPlanDesarrolloDetail() : ''">
        <span  *ngIf="fase !== 'planDesarrollo'" class="capitalize mr-2">{{  endsWithOn(formatFaseName(fase)) }}:</span>
        <span  *ngIf="fase === 'planDesarrollo'" class="capitalize mr-2">Plan individual de desarrollo (PID):</span>
        <span class="text-gray-600">
          {{ fase !== 'planDesarrollo' 
             ? (formatFecha(getFaseControl(fase).get('inicio')?.value) || 'No definido') + ' - ' + (formatFecha(getFaseControl(fase).get('fin')?.value) || 'No definido')
             : 'Múltiples fechas' }}
        </span>
        <svg *ngIf="fase === 'planDesarrollo'" class="mr-2 h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
        </svg>
        <div *ngIf="ViewPlanDesarrolloDetail && fase === 'planDesarrollo'" class="mt-2">
          <span>Registro y Evaluación: {{formatFecha(calendarioForm.get('fases').get('planDesarrollo').get('EstablecimientoYAprobaciónPID').get('inicio')?.value) || 'No definido' }} - {{ formatFecha(calendarioForm.get('fases').get('planDesarrollo').get('EstablecimientoYAprobaciónPID').get('fin')?.value) || 'No definido' }}</span> 
          <br>
          <span>Registro de Cumplimiento, Validación y Seguimiento: {{formatFecha(calendarioForm.get('fases').get('planDesarrollo').get('RegistroYEvaluaciónCumplimientoPID').get('inicio')?.value) || 'No definido' }} - {{ formatFecha(calendarioForm.get('fases').get('planDesarrollo').get('RegistroYEvaluaciónCumplimientoPID').get('fin')?.value) || 'No definido' }}</span>
        </div>
      </li>
    </ul>
    
  </div>

  <footer class="bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4">
    <div class="mx-auto flex justify-end space-x-4">
      <button type="button" (click)="CancelButton()" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
        Cancelar
      </button>
      <button type="submit" (click)="onSubmit()" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
        <svg class="inline-block mr-2 h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd" />
        </svg>
        Guardar Calendario
      </button>
    </div>
  </footer>
</div>